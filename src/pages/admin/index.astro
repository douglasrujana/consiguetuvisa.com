---
// src/pages/admin/index.astro - Dashboard Admin con Sidebar
import { SignedIn, SignedOut } from '@clerk/astro/components';
import AdminLayout from '../../components/admin/AdminLayout.svelte';
import UsersCrud from '../../components/admin/UsersCrud.svelte';
import Button from '../../components/ui/Button.astro';

// Obtener usuario local desde middleware (ya verificado como ADMIN)
const { auth, localUser } = Astro.locals as any;
const { userId } = auth();

const isAdmin = localUser?.role === 'ADMIN';
const adminName = localUser?.firstName || localUser?.email?.split('@')[0] || 'Admin';
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - ConsigueTuVisa</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body>
  <SignedOut>
    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #f3f4f6;">
      <div style="text-align: center; background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h1 style="font-size: 1.5rem; font-weight: 700; color: #1f2937; margin-bottom: 1rem;">Acceso Restringido</h1>
        <p style="color: #6b7280; margin-bottom: 1.5rem;">Debes iniciar sesión como administrador.</p>
        <a href="/login" style="display: inline-block; background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 500;">
          Iniciar Sesión
        </a>
      </div>
    </div>
  </SignedOut>

  <SignedIn>
    {isAdmin ? (
      <AdminLayout client:load adminName={adminName} currentPage="usuarios">
        <UsersCrud client:load />
      </AdminLayout>
    ) : (
      <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #f3f4f6;">
        <div style="text-align: center; background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
          <h1 style="font-size: 1.5rem; font-weight: 700; color: #dc2626; margin-bottom: 1rem;">Acceso Denegado</h1>
          <p style="color: #6b7280; margin-bottom: 1.5rem;">No tienes permisos de administrador.</p>
          <a href="/dashboard" style="display: inline-block; background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 500;">
            Ir a Mi Panel
          </a>
        </div>
      </div>
    )}
  </SignedIn>
</body>
</html>
