---
// src/components/home/ServicesGrid.astro
// Carga "Tipos de Visa" desde Sanity

import Section from '../ui/Section.astro';
import Card from '../ui/Card.astro';
import Icon from '../ui/Icon.astro';
import Button from '../ui/Button.astro';
import { getServices, getFlagUrl } from '../../lib/sanity/services.service';

const data = await getServices();
---

<Section id="servicios" background="light">
  <div class="text-center mb-12 animate-on-scroll fade-up">
    <div class="accent-line mx-auto mb-4"></div>
    <h2 class="heading-section mb-4">{data.title}</h2>
    {data.subtitle && (
      <p class="text-body max-w-2xl mx-auto">{data.subtitle}</p>
    )}
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {data.items.map((visa, index) => (
      <Card class={`group hover-lift animate-on-scroll fade-up delay-${(index % 3) + 1}`}>
        <div class="flex items-start gap-4">
          <img 
            src={getFlagUrl(visa.flagCode || 'un')} 
            alt={`Bandera de ${visa.country}`}
            width="48"
            height="36"
            loading="lazy"
            class="w-12 h-9 object-cover rounded shadow-sm flex-shrink-0"
          />
          <div class="flex-1">
            <h3 class="heading-card mb-2 group-hover:text-brand-secondary transition-colors">
              {visa.country}
            </h3>
            <p class="text-body mb-4">{visa.description}</p>
            <a 
              href={visa.link || '#contacto'} 
              class="inline-flex items-center gap-1 text-brand-secondary font-medium hover:gap-2 transition-all"
            >
              Más información
              <Icon name="arrow" size={16} />
            </a>
          </div>
        </div>
      </Card>
    ))}
  </div>

  <div class="text-center mt-10 animate-on-scroll fade-up">
    <Button href="#contacto" size="lg" class="hover-scale">
      Agenda tu Asesoría
      <Icon name="arrow" size={20} />
    </Button>
  </div>
</Section>
