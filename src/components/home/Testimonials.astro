---
// src/components/home/Testimonials.astro
// Carga "Casos de Éxito" desde Sanity

import Section from '../ui/Section.astro';
import Card from '../ui/Card.astro';
import Icon from '../ui/Icon.astro';
import { getTestimonials } from '../../lib/sanity/testimonials.service';

const data = await getTestimonials();
---

<Section id="testimonios" background="light">
  <div class="text-center mb-12 animate-on-scroll fade-up">
    <div class="accent-line mx-auto mb-4"></div>
    <h2 class="heading-section mb-4">{data.title}</h2>
    {data.subtitle && (
      <p class="text-body max-w-2xl mx-auto">{data.subtitle}</p>
    )}
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    {data.items.map((testimonial, index) => (
      <Card class={`hover-lift animate-on-scroll fade-up delay-${index + 1}`}>
        <!-- Rating -->
        <div class="flex gap-1 mb-4">
          {Array.from({ length: testimonial.rating || 5 }).map(() => (
            <Icon name="star" size={18} class="text-warning fill-warning" />
          ))}
        </div>

        <!-- Quote -->
        <p class="text-body mb-6 italic">"{testimonial.text}"</p>

        <!-- Author -->
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-brand-secondary/20 rounded-full flex items-center justify-center">
            <span class="text-brand-secondary font-bold">
              {testimonial.name.charAt(0)}
            </span>
          </div>
          <div>
            <p class="font-semibold text-brand-primary">{testimonial.name}</p>
            <p class="text-small">{testimonial.location}{testimonial.visa && ` • ${testimonial.visa}`}</p>
          </div>
        </div>
      </Card>
    ))}
  </div>
</Section>
