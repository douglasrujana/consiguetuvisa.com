---
// src/components/seo/SchemaMarkup.astro
/**
 * JSON-LD Schema Markup para SEO
 * Incluye: LocalBusiness, FAQ, AggregateRating
 */

import type { SiteSettings } from '$lib/sanity/siteSettings.service';

interface FAQ {
  question: string;
  answer: string;
}

interface Props {
  settings: SiteSettings;
  faqs?: FAQ[];
  includeLocalBusiness?: boolean;
  includeFAQ?: boolean;
  includeRating?: boolean;
}

const { 
  settings, 
  faqs = [], 
  includeLocalBusiness = true,
  includeFAQ = false,
  includeRating = true,
} = Astro.props;

const siteUrl = import.meta.env.SITE_URL || 'https://consiguetuvisa.com';

// Schema: LocalBusiness
const localBusinessSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": `${siteUrl}/#business`,
  "name": settings.siteName || "ConsigueTuVisa",
  "description": settings.description || "Asesoría profesional para visas de turismo",
  "url": siteUrl,
  "telephone": settings.phone,
  "email": settings.email,
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Quito",
    "addressRegion": "Pichincha",
    "addressCountry": "EC",
    "streetAddress": settings.address || ""
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": -0.1807,
    "longitude": -78.4678
  },
  "openingHoursSpecification": [
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
      "opens": "09:00",
      "closes": "18:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": "Saturday",
      "opens": "09:00",
      "closes": "13:00"
    }
  ],
  "sameAs": [
    settings.facebook,
    settings.instagram,
    settings.tiktok
  ].filter(Boolean),
  "priceRange": "$$",
  "image": `${siteUrl}/og-image.jpg`,
  "serviceArea": {
    "@type": "Country",
    "name": "Ecuador"
  }
};

// Schema: AggregateRating
const ratingSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": settings.siteName || "ConsigueTuVisa",
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "reviewCount": "127",
    "bestRating": "5",
    "worstRating": "1"
  }
};

// Schema: FAQPage
const faqSchema = faqs.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(faq => ({
    "@type": "Question",
    "name": faq.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": faq.answer
    }
  }))
} : null;

// Schema: Organization
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": settings.siteName || "ConsigueTuVisa",
  "url": siteUrl,
  "logo": `${siteUrl}/logo.png`,
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": settings.phone,
    "contactType": "customer service",
    "availableLanguage": "Spanish"
  },
  "sameAs": [
    settings.facebook,
    settings.instagram,
    settings.tiktok
  ].filter(Boolean)
};

// Schema: WebSite (para búsqueda)
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": settings.siteName || "ConsigueTuVisa",
  "url": siteUrl,
  "potentialAction": {
    "@type": "SearchAction",
    "target": `${siteUrl}/buscar?q={search_term_string}`,
    "query-input": "required name=search_term_string"
  }
};
---

{/* Organization Schema - Siempre incluido */}
<script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />

{/* WebSite Schema - Siempre incluido */}
<script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

{/* LocalBusiness Schema */}
{includeLocalBusiness && (
  <script type="application/ld+json" set:html={JSON.stringify(localBusinessSchema)} />
)}

{/* AggregateRating Schema */}
{includeRating && (
  <script type="application/ld+json" set:html={JSON.stringify(ratingSchema)} />
)}

{/* FAQ Schema */}
{includeFAQ && faqSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
)}
